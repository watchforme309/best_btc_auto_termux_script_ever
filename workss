#!/data/data/com.termux/files/usr/bin/bash
set -e

clear
echo "======================================"
echo " BTC MULTI-POOL SOLO MINER (TERMUX) "
echo " Pools: CKPOOL SOLO + Public-Pool.io "
echo " Algorithm: sha256d (Bitcoin only)"
echo "======================================"
echo

read -p "Enter your BTC address: " BTC
echo

if [[ ! $BTC =~ ^[13bc][a-zA-Z0-9]{20,}$ ]]; then
    echo "Invalid BTC address."
    exit 1
fi

echo "[*] Updating Termux..."
pkg update -y && pkg upgrade -y

echo "[*] Installing dependencies..."
pkg install -y git clang make automake autoconf libtool pkg-config \
               openssl curl libjansson libgmp

echo "[*] Cloning cpuminer-multi..."
cd $HOME
rm -rf cpuminer-multi
git clone https://github.com/tpruvot/cpuminer-multi.git
cd cpuminer-multi

echo "[*] Building miner..."
./autogen.sh
CFLAGS="-O2" ./configure --with-crypto --with-curl
make -j$(nproc)

echo
echo "======================================"
echo " STARTING MULTI-POOL BTC MINING "
echo "======================================"
echo

# Run CKPOOL SOLO in background
./cpuminer \
  -a sha256d \
  -o stratum+tcp://solo.ckpool.org:4334 \
  -u $BTC.termux \
  -p x \
  -t 1 \
  --cpu-priority 5 \
  --no-color &

# Run Public-Pool.io in background
./cpuminer \
  -a sha256d \
  -o stratum+tcp://public-pool.io:21496 \
  -u $BTC.termux \
  -p x \
  -t 1 \
  --cpu-priority 5 \
  --no-color &

echo "[*] Mining started on both pools!"
echo "[*] Check your CKPOOL stats here:"
echo "https://solo.ckpool.org/users/$BTC"
echo
wait
